@page "/reservations"
@using Microsoft.EntityFrameworkCore
@using Microsoft.AspNetCore.Components.QuickGrid
@using Table4U
@using Table4U.Data
@implements IAsyncDisposable
@inject IDbContextFactory<Table4U.Data.Table4UContext> DbFactory
@attribute [StreamRendering(true)]

<PageTitle>Reservations</PageTitle>

<h1>Reservation</h1>

<a class="my-3" href="reservations/create"><span class="bi bi-plus-square-fill" aria-hidden="true"></span></a>

@if (context == null)
{
    <p>Loading...</p>
}
else
{
    <QuickGrid Class="table" Items="context?.Reservation">
        <PropertyColumn Property="reservation => reservation.Name" Sortable="true" class="align-content-center justify-content-center" />
        <PropertyColumn Property="reservation => reservation.Date" Format="yyyy.MM.dd" Sortable="true" class="align-content-center justify-content-center" />
        <PropertyColumn Property="reservation => reservation.Time" Sortable="true" class="align-content-center justify-content-center" />
        <PropertyColumn Property="reservation => reservation.PeopleCount" Sortable="true" class="align-content-center justify-content-center" />
        <PropertyColumn Property="reservation => reservation.TableId" Sortable="true" class="align-content-center justify-content-center" />

        <TemplateColumn Context="reservation">
            <a class="btn btn-primary mx-2" href="@($"reservations/edit?id={reservation.Id}")">Edit</a> |
            <a class="btn btn-success mx-2" href="@($"reservations/details?id={reservation.Id}")">Details</a> |
            <a class="btn btn-danger mx-2" href="@($"reservations/delete?id={reservation.Id}")">Delete</a>
        </TemplateColumn>
    </QuickGrid>
}



@code {
    private Table4UContext context = default!;

    protected override async Task OnInitializedAsync()
    {
        await Task.Delay(1);
        context = DbFactory.CreateDbContext();

    }

    public async ValueTask DisposeAsync() => await context.DisposeAsync();
}
